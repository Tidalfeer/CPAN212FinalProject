

<div class="row">
  <div class="col-md-4">
    <% if (movie.posterUrl) { %>
      <img src="<%= movie.posterUrl %>" class="img-fluid rounded mb-3"/>
    <% } else { %>
      <div class="bg-secondary text-white p-5 text-center">No Image</div>
    <% } %>
    <form action="/movies/<%= movie._id %>/like" method="post">
      <button class="btn btn-outline-danger w-100">❤️ Like (<%= movie.likes %>)</button>
    </form>
  </div>
  <div class="col-md-8">
    <h1><%= movie.name %> (<%= movie.year %>)</h1>
    <p><strong>Genres:</strong> <%= (movie.genres||[]).join(', ') %></p>
    <p><strong>Rating:</strong> <%= movie.rating != null ? movie.rating : 'N/A' %></p>
    <p><%= movie.description %></p>

    <% if (currentUser && movie.owner && currentUser.id === movie.owner._id.toString()) { %>
      <a href="/movies/<%= movie._id %>/edit" class="btn btn-warning">Edit</a>
      <form action="/movies/<%= movie._id %>?_method=DELETE" method="post" style="display:inline">
        <button class="btn btn-danger">Delete</button>
      </form>
    <% } %>

    <hr/>
    <h4>Comments (<%= (movie.comments||[]).length %>)</h4>

<% if (currentUser) { %>
  <form action="/movies/<%= movie._id %>/comment" method="post" class="mb-4">
    <div class="mb-2">
      <textarea name="comment" class="form-control" placeholder="Write a comment..." required rows="3"></textarea>
    </div>
    <button class="btn btn-primary">Add Comment</button>
  </form>
<% } else { %>
  <p><a href="/login">Log in</a> to add a comment</p>
<% } %>

<% if (movie.comments && movie.comments.length > 0) { %>
  <ul class="list-group">
    <% movie.comments.forEach(c => { %>
      <li class="list-group-item">
        <strong><%= c.user %></strong>
        <% if (c.date) { %>
          <small class="text-muted ms-2"><%= new Date(c.date).toLocaleDateString() %></small>
        <% } %>
        <p class="mb-0 mt-1"><%= c.text %></p>
      </li>
    <% }) %>
  </ul>
<% } else { %>
  <p class="text-muted">No comments yet. Be the first to comment!</p>
<% } %>
