

<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="mb-0">Movies</h1>
  <a href="/movies/add" class="btn btn-primary">Add Movie</a>
</div>

<form class="row g-2 mb-3" method="GET" action="/movies">
  <div class="col-md-6">
    <input name="search" value="<%= search || '' %>" class="form-control" placeholder="Search movies..." />
  </div>
  <div class="col-auto">
    <select name="sort" class="form-select" onchange="this.form.submit()">
      <option value="">Sort By</option>
      <option value="year" <%= sort==='year' ? 'selected' : '' %>>Year</option>
      <option value="rating" <%= sort==='rating' ? 'selected' : '' %>>Rating</option>
    </select>
  </div>
  <div class="col-auto">
    <button class="btn btn-outline-secondary">Search</button>
  </div>
</form>

<div class="row row-cols-1 row-cols-md-3 g-4">
  <% movies.forEach(m => { %>
    <div class="col">
      <div class="card h-100 shadow-sm">
        <% if (m.posterUrl) { %>
          <img src="<%= m.posterUrl %>" class="card-img-top" style="height:300px;object-fit:cover"/>
        <% } else { %>
          <div class="bg-secondary text-white d-flex align-items-center justify-content-center" style="height:300px">No Image</div>
        <% } %>
        <div class="card-body d-flex flex-column">
          <h5 class="card-title"><a href="/movies/<%= m._id %>"><%= m.name %></a></h5>
          <p class="card-text text-muted mb-1"><%= m.year %> â€¢ <%= (m.genres||[]).join(', ') %></p>
          <p class="mb-2 small"><%= m.description.length > 120 ? m.description.substring(0,120)+'...' : m.description %></p>
          <div class="mt-auto d-flex justify-content-between align-items-center">
            <small class="text-muted">By <%= m.owner ? m.owner.username : 'unknown' %></small>
            <span class="badge bg-primary"><%= m.rating != null ? m.rating : 'N/A' %></span>
          </div>
        </div>
      </div>
    </div>
  <% }) %>
</div>

<nav class="mt-4">
  <ul class="pagination justify-content-center">
    <% if (currentPage > 1) { %>
      <li class="page-item"><a class="page-link" href="/movies?page=<%= currentPage-1 %><%= search? '&search='+encodeURIComponent(search): '' %><%= sort? '&sort='+sort: '' %>">Prev</a></li>
    <% } %>
    <li class="page-item disabled"><span class="page-link">Page <%= currentPage %> of <%= totalPages %></span></li>
    <% if (currentPage < totalPages) { %>
      <li class="page-item"><a class="page-link" href="/movies?page=<%= currentPage+1 %><%= search? '&search='+encodeURIComponent(search): '' %><%= sort? '&sort='+sort: '' %>">Next</a></li>
    <% } %>
  </ul>
</nav>
